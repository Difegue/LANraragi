---
# Docker compose file for dev environments.
services:
  lanraragi:
    build:
      dockerfile: tools/build/docker/Dockerfile-dev
      context: ../../..
    volumes:
      - ../../../:/home/koyomi/lanraragi
    ports:
      - "3000:3000"
    environment:
      - "LRR_REDIS_ADDRESS=redis:6379"
    networks:
      - lrr

  redis:
    image: "docker.io/redis:7"
    volumes:
      - redis_test_data:/data
    networks:
      - lrr

  python-tests:
    build:
      dockerfile: tools/build/docker/Dockerfile-python
      context: ../../..
    volumes:
      - ../../../tests/python:/tests
      - ../../../:/lanraragi
    working_dir: /tests
    networks:
      - lrr
    depends_on:
      - lanraragi
      - redis
    command: ["tail", "-F", "Anything"]

networks:
  lrr:

volumes:
  redis_test_data:
