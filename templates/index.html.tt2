<!DOCTYPE html>

<head>
	<title>[% title %]</title>

	<meta name="viewport" content="width=device-width" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<link type="image/png" rel="icon" href="favicon.ico" />
	<link rel="stylesheet" type="text/css" href="/css/lrr.css?[% version%]" />

	<link rel="stylesheet" type="text/css" href="/css/vendor/fontawesome-all.min.css" />
	<link rel="stylesheet" type="text/css" href="/css/vendor/jquery.toast.min.css" />
	<link rel="stylesheet" type="text/css" href="/css/vendor/jquery.qtip.min.css" />
	<link rel="stylesheet" type="text/css" href="/css/vendor/jquery.contextMenu.min.css" />
	<link rel="stylesheet" type="text/css" href="/css/vendor/awesomplete.css" />
	[% csshead %]

	<script src="/js/vendor/jquery.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery-migrate.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery.dataTables.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery.toast.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery.qtip.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery.ui.position.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/jquery.contextMenu.min.js" type="text/JAVASCRIPT"></script>
	<script src="/js/vendor/awesomplete.min.js" type="text/JAVASCRIPT"></script>

	<script src="/js/index.js?[% version%]" type="text/JAVASCRIPT"></script>
	<script src="/js/ajax.js?[% version%]" type="text/JAVASCRIPT"></script>
	<script src="/js/index_datatables.js?[% version%]" type="text/JAVASCRIPT"></script>
	<script src="/js/theme.js?[% version%]" type="text/JAVASCRIPT"></script>

</head>

<body>

	[% IF userlogged %]
	<p id="nb">
		<i class="fa fa-caret-right"></i>
		<a href="./upload">ä¸Šä¼ æ–‡ä»¶</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./stats">ç»Ÿè®¡</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./logs">å…³äº</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./config">åå°</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./logout">ç™»å‡º</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="https://wdnmd.network" target="_blank">ç™½ç»™</a>
	</p>
	[% ELSE %]
	<p id="nb">
		<i class="fa fa-caret-right"></i>
		<a href="./upload">ä¸Šä¼ æ–‡ä»¶</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./stats">ç»Ÿè®¡</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./logs">å…³äº</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="https://wdnmd.network" target="_blank">ç™½ç»™</a>
		<span style="margin-left:5px"></span>
		<i class="fa fa-caret-right"></i>
		<a href="./login">ç®¡ç†å‘˜ç™»å½•</a>
	</p>
	[% END %]

	<div class='ido'>
		<h1 class='ih'>[% motd %]</h1>
		<div id='toppane'>
			<div class='idi'>

				[% IF favtags && favtags.size %]
				<div>
					[% FOREACH tag IN favtags %]
					<div style="display:inline-block">
						<input class='favtag' id='[% tag %]' type='hidden' />
						<input class='favtag-btn' type='button' value='[% tag %]' onclick='toggleFav(this)'
							title='ç‚¹å‡»æœç´¢æ­¤æ ‡ç­¾' />
					</div>
					[% END %]
				</div>
				[% END %]

				<input type='text' id='srch' class='search stdinput' size='90' style='width:100%' 
					placeholder='åœ¨è¿™é‡Œæœç´¢ä½œå“ï¼Œä½œè€…ï¼Œç³»åˆ—ï¼Œè¯­è¨€æˆ–æ ‡ç­¾' />
				<input id='clrsrch' class='stdbtn' type='button' value='æ¸…é™¤è¿‡æ»¤å™¨' />
			</div>

			<p id='cssbutton' style='display:inline'>
				<input id='inboxbtn' class='stdbtn' type='button' onclick='toggleInbox(this)'
					value='åªæ˜¾ç¤ºæœ€æ–°ä¸Šä¼ çš„ä½œå“' />
				<input class='stdbtn' type='button' onclick="var win=window.open('random','_blank'); win.focus();"
					value='ç»™ğŸ‘´éšä¾¿æ¥ä¸€ä¸ª' />
				<input id='viewbtn' class='stdbtn' type='button' onclick="switch_index_view()"
					value='åˆ‡æ¢ä¸ºåˆ—è¡¨æ¨¡å¼' />
			</p>

			<table class="itg datatables">
				<thead>
					<tr>
						<th id="titleheader">
							<a>ä½œå“</a>
						</th>
						<th id="artistheader">
							<a>ä½œå®¶</a>
						</th>
						<th id="seriesheader">
							<a>ç³»åˆ—</a>
						</th>
						<th id="tagsheader">
							<a>æ ‡ç­¾</a>
						</th>
						<th id="titleheader">
							<a>æ˜¯å¦æœ€æ–°ä¸Šä¼ </a>
						</th>
					</tr>
				</thead>
				<tbody class="list">
				</tbody>
			</table>

			<div id="json-error" style="display:none">
				<h1 style="color: red">
					<i class="fas fa-bomb"></i>è™½ç„¶æˆ‘ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½†æ˜¯æ•°æ®åº“åäº†ï¼Œæˆ‘çš„æœ‹å‹
					<i class="fas fa-bomb"></i>
				</h1>
				<h2>æ•°æ®åº“ç¼“å­˜å·²æŸåï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•æ˜¾ç¤ºä½ çš„å­˜æ¡£åˆ—è¡¨
					<br> ä½ å¯ä»¥<a href="/api/discard_cache">here</a> ç‚¹æˆ‘ </h2> è¯•è¯•ä¿®å¤
			</div>

		</div>
	</div>

	[% INCLUDE footer %]

	[% IF debugmode %]
	<i class="fas fa-bug"></i> You're running in Debug Mode!
	<i class="fas fa-bug"></i>
	[% END %]

	<script>

		// Default to thumbnail mode
		if (localStorage.getItem("indexViewMode") === null) {
			localStorage.indexViewMode = 1;
		}

		//load archive JSON before anything else
		$.getJSON("api/archivelist", function (data) {
			initIndex([% pagesize %], data);
		}).fail(function (d) {
			//Catastrophic cache fuckup, inform the user
			$(".datatables").hide();
			$("#json-error").show();
		});

		[% IF usingdefpass %]
		//If the json has the "default password" flag, flash a friendly notification inviting the user to change his password
		$.toast({
			heading: 'You\'re using the default password and that\'s super baka of you',
			text: '<a href="login">Login</a> with password "kamimamita" and <a href="config">change that shit</a> on the double.<br/>...Or just disable it! <br/>Why not check the configuration options afterwards, while you\'re at it? ',
			hideAfter: false,
			position: 'top-left',
			icon: 'error'
		});
		[% END %]

		[% IF buildingDBcache %]
		//This notification flashes when the JSON cache for the archive DB is rebuilding - 
		//usually due to a new archive or metadata being updated.
		$.toast({
			heading: 'The database cache is currently building',
			text: 'All your archives might not appear in this list yet, but they will! Eventually. <br/>Try refreshing the page a bit later. You can also check the current state of the build through the <a href="logs">logs</a>.',
			hideAfter: false,
			position: 'top-left',
			icon: 'warning'
		});
		[% END %]

		if (localStorage.indexViewMode === 1)
			$("#viewbtn").val("åˆ‡æ¢ä¸ºç›¸å†Œæ¨¡å¼");
		else {
			$("#viewbtn").val("åˆ‡æ¢ä¸ºåˆ—è¡¨æ¨¡å¼");
			$('.itg').hide();
		}

		[% IF debugmode %][% ELSE %]
		checkVersion("[% version %]");
		[% END %]

		// Initialize context menu
		$.contextMenu({
			selector: '.id1,.image-tooltip', 
			callback: function(key, options) {
				handleContextMenu(key, $(this).attr("id"));
			},
			items: {
				[% IF userlogged %]
				"edit": {name: "Edit Metadata", icon: "fas fa-pencil-alt"},
				"delete": {name: "Delete", icon: "fas fa-trash-alt"},		
				"sep1": "---------",		
				[% END %]
				"read": {name: "Read", icon: "fas fa-book"},
				"download": {name: "Download", icon: "fas fa-save"}
			}
		});

		// Tell user about the context menu
		if (localStorage.getItem("sawContextMenuToast") === null) {
			localStorage.sawContextMenuToast = true;

			$.toast({
			heading: 'æ¬¢è¿æ¥åˆ°æˆ‘çš„å®åº“ï¼Œæœ‹å‹!',
			text: "é˜…è¯»æ—¶ä½¿ç”¨è®¾ç½®èœå•æ¥æ¿€æ´»æ¨èé€‰é¡¹ä»¥å¸¦æ¥æ›´å¥½çš„ç¤¾ä¿ä½“éªŒï¼Œä¸€è·¯å¹³å®‰ï¼",
			hideAfter: false,
			position: 'top-left',
			icon: 'info'
			});
		}

		// Initialize tag suggestions
		loadTagSuggestions();

	</script>

</body>

</html>